# Environment

### OS
```
debian-12.9.0-amd64-netinst.iso
```

#### info
$ ``cat /etc/os-release``
```
PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
NAME="Debian GNU/Linux"
VERSION_ID="12"
VERSION="12 (bookworm)"
VERSION_CODENAME=bookworm
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
```
### Java
$ ``java -version``
```shell
openjdk version "17.0.13" 2024-10-15
OpenJDK Runtime Environment (build 17.0.13+11-Debian-2deb12u1)
OpenJDK 64-Bit Server VM (build 17.0.13+11-Debian-2deb12u1, mixed mode, sharing)
```

### Maven
$ ``mvn -version``
```shell
Apache Maven 3.8.7
Maven home: /usr/share/maven
Java version: 17.0.13, vendor: Debian, runtime: /usr/lib/jvm/java-17-openjdk-amd64
Default locale: en, platform encoding: UTF-8
OS name: "linux", version: "6.1.0-29-amd64", arch: "amd64", family: "unix"
```

### nodejs
$ ``node -v``
```shell
v18.19.0
```
$ ``npm -v``
```
### npm
```shell
9.2.0
```

### Docker Engine
$ ``docker --version``
```shell
Docker version 27.5.0, build a187fa5
```

# Build

https://thingsboard.io/docs/user-guide/install/building-from-source/

### build step (sh)
```shell
# checkout latest release branch
git clone -b release-3.9 git@github.com:thingsboard/thingsboard.git --depth 1
cd thingsboard

# Build local docker images
mvn clean install -DskipTests -Ddockerfile.skip=false
```
![image](https://hackmd.io/_uploads/HJTnvmNDyx.png)

### msa/tb/target/
$ ``
ls -hl msa/tb/target/
``
```
total 8.5M
drwxr-xr-x 2 root root 4.0K Jan 14 18:48 docker
drwxr-xr-x 2 root root 4.0K Jan 14 18:45 docker-cassandra
drwxr-xr-x 2 root root 4.0K Jan 14 18:45 docker-postgres
drwxr-xr-x 2 root root 4.0K Jan 14 18:48 maven-archiver
-rw-r--r-- 1 root root 8.5M Jan 14 18:45 protoc-3.25.5-linux-x86_64.exe
-rw-r--r-- 1 root root 4.3K Jan 14 18:52 tb-3.9.0-docker-info.jar
drwxr-xr-x 3 root root 4.0K Jan 14 18:48 test-classes
```

## full shell script including the environment setup (sh)
```shell==
#!/bin/sh

# openjdk 17
apt install -y openjdk-17-jdk
java -version

# maven
apt install -y maven
mvn -version

# nodejs
apt install -y nodejs
node -v

# npm
apt install -y npm
npm -v

# docker - start
# https://docs.docker.com/engine/install/debian/
for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get -y remove $pkg; done

# Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update

sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
docker --version
# docker - end


# build from source - start
# https://thingsboard.io/docs/user-guide/install/building-from-source/
# checkout latest release branch
git clone -b release-3.9 git@github.com:thingsboard/thingsboard.git --depth 1
cd thingsboard

# Build local docker images
mvn clean install -DskipTests -Ddockerfile.skip=false
# build from source - end
```

# Start the service

https://thingsboard.io/docs/user-guide/install/docker/

## file structure:
```yml
- app/
  - docker-compose.yml
  - mytb-data/
  - mytb-logs/
```
## step

### ensure the image exists (sh)
$ ``docker images``
![image](https://hackmd.io/_uploads/HkzFZliDkg.png)

### docker-compose.yml
```yml==
version: '3.0'
services:
  mytb:
    restart: always
    image: "thingsboard/tb-postgres"
    ports:
      - "8080:9090" # HTTP
      - "1883:1883" # MQTT
      - "7070:7070" # edge-RPC
      - "5683-5688:5683-5688/udp" # for COAP and LwM2M
    environment:
      TB_QUEUE_TYPE: in-memory
    volumes: # mounts
      - ~/.mytb-data:/data
      - ~/.mytb-logs:/var/log/thingsboard
```
### create mount folders (sh)
```shell==
mkdir -p ~/.mytb-data && sudo chown -R 799:799 ~/.mytb-data
mkdir -p ~/.mytb-logs && sudo chown -R 799:799 ~/.mytb-logs
```
### start the container (sh)
```shell==
docker compose up -d
docker compose logs -f mytb
```
## default credentials:
```
u=sysadmin@thingsboard.org
p=sysadmin
```